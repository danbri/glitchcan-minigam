<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üñºÔ∏è Enhanced Media Gallery</title>
    <style>
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a;
            color: #ecf0f1;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background: #34495e;
            color: #ecf0f1;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: #3498db;
        }
        
        .search-box {
            padding: 8px 12px;
            background: #34495e;
            border: 1px solid #3498db;
            border-radius: 4px;
            color: #ecf0f1;
            min-width: 200px;
        }
        
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .media-item {
            background: #2c3e50;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .media-item:hover {
            border-color: #3498db;
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }
        
        .media-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
            background: #34495e;
        }
        
        .video-preview {
            position: relative;
        }
        
        .video-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
            pointer-events: none;
            backdrop-filter: blur(4px);
        }
        
        .media-info {
            padding: 15px;
        }
        
        .media-description {
            font-size: 13px;
            color: #bdc3c7;
            margin-bottom: 8px;
            line-height: 1.4;
            min-height: 40px;
        }
        
        .media-name {
            font-size: 11px;
            word-break: break-all;
            margin-bottom: 5px;
            line-height: 1.2;
            color: #95a5a6;
        }
        
        .media-type {
            font-size: 10px;
            color: #7f8c8d;
            text-transform: uppercase;
            font-weight: bold;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .modal-content {
            max-width: 95vw;
            max-height: 95vh;
            margin: auto;
            position: relative;
            top: 50%;
            transform: translateY(-50%);
            text-align: center;
        }
        
        .modal img, .modal video {
            max-width: 100%;
            max-height: 75vh;
            object-fit: contain;
            border-radius: 8px;
        }
        
        .modal-info {
            background: rgba(44, 62, 80, 0.95);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            display: inline-block;
            max-width: 600px;
            text-align: left;
        }
        
        .modal-description {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #ecf0f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: #e74c3c;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #95a5a6;
        }
        
        .stats {
            text-align: center;
            margin-bottom: 20px;
            color: #95a5a6;
            font-size: 14px;
        }
        
        @media (max-width: 600px) {
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üñºÔ∏è Enhanced Media Gallery</h1>
        <p>Browse images and videos with AI-generated descriptions and enhanced accessibility</p>
    </div>
    
    <div class="controls">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="image">Images</button>
        <button class="filter-btn" data-filter="video">Videos</button>
        <input type="text" class="search-box" placeholder="Search descriptions or filenames..." id="searchBox">
    </div>
    
    <div class="stats" id="stats">Loading...</div>
    
    <div class="gallery" id="gallery">
        <div class="loading">Loading media files...</div>
    </div>
    
    <div class="modal" id="modal">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div class="modal-content" id="modalContent">
        </div>
    </div>
    
    <script>
        let mediaFiles = [];
        
        // Load metadata from JSON file
        async function loadMetadata() {
            try {
                const response = await fetch('../image_metadata.json?v=' + Date.now());
                const metadata = await response.json();
                
                // Transform JSON-LD format to gallery format, filtering only media files
                mediaFiles = metadata.image
                    .filter(img => img.contentUrl.startsWith('media/'))
                    .map(img => ({
                        filename: img.contentUrl.replace('media/', ''),
                        description: img.description,
                        alt: img.description,  // Use same description for alt text
                        genre: img.genre
                    }));
                
                // Discover additional files not in metadata
                await discoverAdditionalFiles();
                
                loadGallery();
            } catch (error) {
                console.error('Failed to load metadata:', error);
                // Fallback to manual file discovery
                await discoverAdditionalFiles();
                loadGallery();
            }
        }
        
        // Discover files that exist but aren't in metadata
        async function discoverAdditionalFiles() {
            const knownFiles = [
                "03F3BBED-CFD8-446A-AEA8-E17D9CF566F3.png",
                "1CD7A2F8-C207-4420-9C60-60C77DA70516.png",
                "1F5FFF26-F815-478F-AD62-522CB011CDE5.JPEG",
                "1F5FFF26-F815-478F-AD62-522CB011CDE5.png",
                "288390B8-E588-4CDE-AFA7-7612F0F9DF91.png",
                "37ECA225-5A36-4B04-AF40-4D11B78FE16C.png",
                "383B165C-8F26-44A8-96B2-2E62A9645BB6.png",
                "3E17DDFA-7CA2-44B3-A852-A6A64C0A44BB.png",
                "49259C34-ED3E-43FD-AD0D-11F7CBF4E8B2.png",
                "4CB33058-288A-4F93-BDBE-9CCCF4A0DCAA.png",
                "5437e4f1_e62e_4211_a301_9306d1ca3c9c.mp4",
                "546ADC22-C6F0-4BA0-BA19-EFAE18E93E29.png",
                "590C2081-0A9F-42B5-9128-909E629BBAD0.png",
                "596A5299-AA05-443E-B7D3-EEEB3D8B5EAA.png",
                "5AE4093E-F93B-4CCD-8E70-6BB8F3D54E19.png",
                "603BC341-4AFD-4E35-A4AE-77BE7C564303.png",
                "6055F905-B41A-4D17-80F9-76F45CC522C3.png",
                "616991D1-18B1-4E73-A61A-C44D76023CAB.png",
                "68DCC484-0992-4E9B-8543-B7C5F29F729A-1.png",
                "68DCC484-0992-4E9B-8543-B7C5F29F729A.png",
                "6D27939D-8543-4A73-8F65-81D9F8C2E0DE.png",
                "6E992CE5-A92F-45EE-A94C-9336B63513DE.png",
                "6dc70b36-91a2-42fd-b6fd-5f3e7c1169eb.mp4",
                "72acd4ca_14be_4769_9224_215099a3504b.mp4",
                "827115E8-9A15-401B-A429-381A25325101.png",
                "8A85D856-4662-4425-ABFB-5F7A2F3DBF36.png",
                "95E0F783-0B0A-403E-8AF7-02404221FA0E.png",
                "97EA1FC7-CA24-4F34-A425-305242ED3949.png",
                "9C2A6066-A174-4C64-A0B2-D0BE87B23792_2025-03-07T09-02-01_upscaled.mp4",
                "A4F6EB35-0334-4E3E-9B5F-5DD4D0FF403A.png",
                "A6ECE166-CA68-47FC-8D41-815EB95F5FEF.png",
                "AFC4774C-5ABB-434B-B45C-89CB4BB1A36F.png",
                "B266C9A3-9402-4622-962E-129F6921D855.png",
                "B6343CE4-917A-49CB-BF67-32F517B5BE1A.png",
                "B803ED86-A395-429E-ABC1-6E3DDC4AFE0E.png",
                "BE621CCB-627A-4D51-B894-884685EE2607.png",
                "BF0B4114-C919-455B-950D-D6332CBCA095.png",
                "C1130841-8AD0-4FD0-B5B6-E3E22514F3F9.png",
                "C431EB91-07CC-44C9-A24E-3976C64158EB.png",
                "C69EC766-9D12-4686-BD3D-B3F9AD356C41.png",
                "CA45D43C-8DB4-4214-A574-5BFC424D9136.png",
                "D26D98D2-F85F-483A-84E0-F21CD1EA7AC4.png",
                "D78E805C-A5F4-4CCE-ABAD-F60A6296ABC4.png",
                "DE351903-562D-4CE8-91C9-00B9FA4E21BB.png",
                "DE3FFCDF-527B-4247-86E1-F0FB73BDBAC3.png",
                "E1E8E642-0058-4D3A-A168-FC3DC001A322-1.png",
                "E1E8E642-0058-4D3A-A168-FC3DC001A322.png",
                "E4C85ECB-2AD7-4AE4-9B36-1C8271E3D503.png",
                "E52C8509-E3BB-4177-957F-80E4E11D2119.png",
                "E70260A2-3326-46B9-B5A6-AE31C68FB5C5.png",
                "EA0E5AC2-4D25-403B-B098-5D793721513A.png",
                "EA969AD0-24EE-4A5D-99F1-3A576217C355.png",
                "F025B9B6-5A9C-47F5-8FE8-2AB91C603C4E.png",
                "F1643523-32EF-4852-B9DC-B356A4E018AC.png",
                "F73167DB-36FF-4C78-8801-9F9CC68A3F89.png",
                "F9BE0838-3B35-4968-8897-8E37BDF3AA76.png",
                "FF1B25CD-52E5-4C8A-9D7D-5DEA2A4298AA.png",
                "IMG_7048.PNG",
                "IMG_7049.PNG",
                "IMG_7068.PNG",
                "IMG_7072.JPEG",
                "IMG_7093.JPEG",
                "IMG_7095.PNG",
                "IMG_7102.PNG",
                "IMG_7103.PNG",
                "IMG_7220.JPEG",
                "IMG_7237.PNG",
                "IMG_7310.PNG",
                "IMG_7317.PNG",
                "IMG_7318.PNG",
                "IMG_7323.JPEG",
                "IMG_7368.PNG",
                "IMG_7369.PNG",
                "IMG_7370.PNG",
                "IMG_7397.PNG",
                "IMG_7431.PNG",
                "IMG_7535.PNG",
                "IMG_7573.PNG",
                "d94a6357-1549-44a1-9173-ce2a9a51d556.mp4"
            ];
            
            const existingFilenames = mediaFiles.map(f => f.filename);
            
            // Add files not already in metadata
            knownFiles.forEach(filename => {
                if (!existingFilenames.includes(filename)) {
                    const type = getFileType(filename);
                    const isIMG = filename.startsWith('IMG_');
                    
                    mediaFiles.push({
                        filename: filename,
                        description: isIMG ? 
                            "Mobile screenshot or photo - specific content requires analysis" :
                            type === 'video' ? 
                                "Video content - specific content requires analysis" :
                                "Image content - specific content requires analysis",
                        alt: isIMG ?
                            "Mobile screenshot or photo" :
                            type === 'video' ?
                                "Video file" :
                                "Image file",
                        genre: isIMG ? "mobile screenshot" : type
                    });
                }
            });
        }
        
        let currentFilter = 'all';
        let currentSearch = '';
        
        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            if (['png', 'jpg', 'jpeg', 'gif', 'webp'].includes(ext)) {
                return 'image';
            } else if (['mp4', 'webm', 'ogg'].includes(ext)) {
                return 'video';
            }
            return 'other';
        }
        
        function createMediaItem(fileData) {
            const type = getFileType(fileData.filename);
            const item = document.createElement('div');
            item.className = 'media-item';
            item.setAttribute('data-type', type);
            item.setAttribute('data-name', fileData.filename.toLowerCase());
            item.setAttribute('data-description', fileData.description.toLowerCase());
            
            let previewElement;
            if (type === 'image') {
                previewElement = `<img class="media-preview" src="${fileData.filename}" alt="${fileData.alt}" loading="lazy" onerror="this.style.display='none'">`;
            } else if (type === 'video') {
                previewElement = `
                    <div class="video-preview">
                        <video class="media-preview" poster="" preload="metadata" muted>
                            <source src="${fileData.filename}" type="video/mp4">
                        </video>
                        <div class="video-overlay">‚ñ∂Ô∏è Video</div>
                    </div>
                `;
            } else {
                previewElement = `<div class="media-preview" style="display: flex; align-items: center; justify-content: center; background: #34495e;">üìÑ</div>`;
            }
            
            item.innerHTML = `
                ${previewElement}
                <div class="media-info">
                    <div class="media-description">${fileData.description}</div>
                    <div class="media-name">${fileData.filename}</div>
                    <div class="media-type">${type}</div>
                </div>
            `;
            
            item.onclick = () => openModal(fileData);
            return item;
        }
        
        function openModal(fileData) {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            const type = getFileType(fileData.filename);
            
            let mediaElement;
            if (type === 'image') {
                mediaElement = `<img src="${fileData.filename}" alt="${fileData.alt}">`;
            } else if (type === 'video') {
                mediaElement = `<video controls autoplay><source src="${fileData.filename}" type="video/mp4"></video>`;
            } else {
                mediaElement = `<p>File type not supported for preview</p>`;
            }
            
            content.innerHTML = `
                ${mediaElement}
                <div class="modal-info">
                    <div class="modal-description"><strong>Description:</strong> ${fileData.description}</div>
                    <strong>Filename:</strong> ${fileData.filename}<br>
                    <strong>Type:</strong> ${type.toUpperCase()}<br>
                    <strong>Alt Text:</strong> ${fileData.alt}<br>
                    <a href="${fileData.filename}" download style="color: #3498db; text-decoration: none; margin-top: 10px; display: inline-block;">üì• Download</a>
                </div>
            `;
            
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        function closeModal() {
            const modal = document.getElementById('modal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // Stop any playing videos
            const videos = modal.querySelectorAll('video');
            videos.forEach(video => {
                video.pause();
                video.currentTime = 0;
            });
        }
        
        function filterMedia() {
            const gallery = document.getElementById('gallery');
            const items = gallery.querySelectorAll('.media-item');
            let visibleCount = 0;
            
            items.forEach(item => {
                const type = item.getAttribute('data-type');
                const name = item.getAttribute('data-name');
                const description = item.getAttribute('data-description');
                
                const typeMatch = currentFilter === 'all' || type === currentFilter;
                const searchMatch = currentSearch === '' || 
                    name.includes(currentSearch.toLowerCase()) || 
                    description.includes(currentSearch.toLowerCase());
                
                if (typeMatch && searchMatch) {
                    item.style.display = 'block';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            
            updateStats(visibleCount);
        }
        
        function updateStats(visibleCount) {
            const stats = document.getElementById('stats');
            const totalImages = mediaFiles.filter(f => getFileType(f.filename) === 'image').length;
            const totalVideos = mediaFiles.filter(f => getFileType(f.filename) === 'video').length;
            
            stats.textContent = `Showing ${visibleCount} of ${mediaFiles.length} files (${totalImages} images, ${totalVideos} videos) ‚Ä¢ Enhanced with AI descriptions`;
        }
        
        function loadGallery() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            
            mediaFiles.forEach(fileData => {
                gallery.appendChild(createMediaItem(fileData));
            });
            
            updateStats(mediaFiles.length);
        }
        
        // Event listeners
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentFilter = e.target.getAttribute('data-filter');
                filterMedia();
            });
        });
        
        document.getElementById('searchBox').addEventListener('input', (e) => {
            currentSearch = e.target.value;
            filterMedia();
        });
        
        // Close modal on escape key or click outside
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });
        
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeModal();
        });
        
        // Load gallery on page load
        loadMetadata();
    </script>
</body>
</html>